<!doctype html>
<html lang="fr">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <!--    <link href="../css/bootstrap.min.css" rel="stylesheet" media="screen">-->
    <link href="../dist/css/bootstrap4-modif.css" rel="stylesheet" media="screen">
    <link href="../dist/css/docs.min.css" rel="stylesheet">
    <link href="../dist/css/docs.perso.css" rel="stylesheet">
    <title>PHP - transmettre des données</title>
    <script>
        // window.ga = window.ga || function () {
        //     (ga.q = ga.q || []).push(arguments)
        // };
        // ga.l = +new Date;
        // ga('create', 'UA-146052-10', 'chchabin.free.fr');
        // ga('set', 'anonymizeIp', true);
        // ga('send', 'pageview');
    </script>
</head>
<body>
<a class="skippy sr-only sr-only-focusable" href="#content">
    <span class="skippy-text">Skip to main content</span>
</a>
<!--        navbar-->
<header class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar">
    <a class="navbar-brand mr-0 mr-md-2" href="/" aria-label="Bootstrap">

    </a>

    <div class="navbar-nav-scroll">
        <ul class="navbar-nav bd-navbar-nav flex-row">
            <li class="nav-item">
                <a class="nav-link " href="php01Gintroduction.html"
                   onclick="ga('send', 'event', 'Navbar', 'Community links', 'Bootstrap');">Guide PHP</a>
            </li>
            <li class="nav-item">
                <a class="nav-link active" href="index.html"
                   onclick="ga('send', 'event', 'Navbar', 'Community links', 'Docs');">Documentation</a>
            </li>
        </ul>
    </div>
</header>
<div class="container-fluid">
    <div class="row flex-xl-nowrap">
        <!--        Menu Gauche-->
        <div class="col-12 col-md-3 col-xl-2 bd-sidebar">
            <nav class="collapse bd-links" id="bd-docs-nav">
                <div class="bd-toc-item">
                    <a class="bd-toc-link " href="php01Gintroduction.html">
                        I - Introduction au développement Web
                    </a>

                    <ul class="nav bd-sidenav">
                        <li>
                            <a href="#foncweb">
                                A - Le fonctionnement du Web
                            </a>
                        </li>
                        <li>
                            <a href="#protocole-HTTP">
                                B - Le protocole HTTP
                            </a>
                        </li>
                        <li>
                            <a href="#siteDyn">C - L'évolution vers des sites dynamiques
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="bd-toc-item ">
                    <a class="bd-toc-link" href="php02Gbaseslg.html">
                        II - Les bases du langage
                    </a>
                </div>
                <div class="bd-toc-item">
                    <a class="bd-toc-link" href="php031ProgPhp_Variables.html">
                        III - Programmer avec PHP
                    </a>

                    <ul class="nav bd-sidenav">
                        <li>
                            <a href="#variables">A - Les variables
                            </a>
                        </li>
                        <li>
                            <a href="#tests">B - Tests et conditions
                            </a>
                        </li>
                        <li>
                            <a href="#tableau">C - Les tableaux
                            </a>
                        </li>
                        <li>
                            <a href="#boucles">D - Les boucles
                            </a>
                        </li>
                        <li>
                            <a href="#fonctions"> E - Les fonctions
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="bd-toc-item">
                    <a class="bd-toc-link" href="php041Transmission.html">
                        IV - Transmettre des données entre des pages
                    </a>

                    <ul class="nav bd-sidenav">
                        <li>
                            <a href="#superglobale">A - Notion de variable superglobale
                            </a>
                        </li>
                        <li>
                            <a href="#transmissionURL">B - Transmission via l'URL
                            </a>
                        </li>
                        <li>
                            <a href="#transmissionForm">C - Transmission via un formulaire
                            </a>
                        </li>
                        <li>
                            <a href="#transmissionData">D - Transmission de données et sécurité
                            </a>
                        </li>
                        <li>
                            <a href="#transmissionSession">E - Transmission via la session
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="bd-toc-item active">
                    <a class="bd-toc-link" href="php05AccesSGBD_Introduction.html">
                        V - Accéder à une base de données
                    </a>

                    <ul class="nav bd-sidenav">
                        <li>
                            <a href="php05AccesSGBD_Introduction.html"> A - Introduction
                            </a>
                        </li>
                        <li>
                            <a href="php05AccesSGBD_Connexion.html">B - Connexion à la base de données
                            </a>
                        </li>
                        <li>
                            <a href="php05AccesSGBD_RappelSQL.html">C - Rappel SQL avec <code>SELECT</code>
                            </a>
                        </li>
                        <li>
                            <a href="php05AccesSGBD_RqtSimple.html">D - <code>query</code> - Requêtes simples
                            </a>
                        </li>
                        <li>
                            <a href="php05AccesSGBD_RqtParam.html">E - <code>prepare</code> et <code>execute</code> - Requêtes avec paramètres
                            </a>
                        </li>
                        <li>
                            <a href="php05AccesSGBD_RqtLMD.html">F - Le cas particulier avec <code>INSERT</code>, <code>UPDATE</code>,
                                <code>DELETE</code> et <code>exec</code>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

        </div>
        <!--        Menu droite-->
        <div class="d-none d-xl-block col-xl-2 bd-toc">
            <ul class="section-nav">
                <li class="toc-entry toc-h3"><a href="#connConf">1 - Configuration de la connexion avec <code>PDO</code></a></li>
                <li class="toc-entry toc-h2"><a href="#connExcept">2 - <code>try/catch</code> La gestion des exceptions</a></li>

            </ul>
        </div>
        <!--        Page de cours-->
        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 bd-content" role="main">
            <h1 class="bd-title" id="content"> V - Accéder à une base de données</h1>
            <h2 id="sgbdConect">B - Connexion à la base de données</h2>
            <section>
                <h3 id="connConf">1 - Configuration de la connexion avec <code>PDO</code></h3>
                <article>
                    <p>La connexion à une base de données depuis un fichier source PHP est réalisée de manière orientée
                        objet, en instanciant un objet de la classe <code>PDO</code> par le biais de son constructeur.
                    </p>
                    <figure class="highlight"><pre><code class="language-php" data-lang="php">$bdd = new <span
                            class="s">PDO</span> ("<span class="cp">mysql</span>:<span class="na">host=</span><span
                            class="s">localhost</span>;<span class="na">dbname=</span><span
                            class="s">mabase</span>;<span class="na">charset=</span><span class="s">utf8</span>",<span
                            class="s">"mabase_util"</span>,
        <span class="s">"mabase_mdp"</span>, <span class="na">array</span>(<span class="cp">PDO::ATTR_ERRMODE</span>  =&gt; <span
                                class="cp">PDO::ERRMODE_EXCEPTION</span> ));</code></pre>
                    </figure>
                    <p>Le constructeur utilisé ici comporte quatre paramètres :</p>
                    <ul>
                        <li>Le premier paramètre (<code>mysql:...</code>) définit le nom de la source de données ou DSN,
                            <em>Data Source Name</em>. Ce nom contient le nom et le type du SGBD (ici MySQL sur la
                            machine locale, <code>localhost</code>), le nom de la base de données (ici
                            <code>mabase</code>) et le jeu de caractères utilisé (ici <code>utf8</code>).
                        </li>
                        <li>Le deuxième paramètre (<code>mabase_util</code>) est le login utilisé pour se connecter à la
                            BD. Il doit auparavant avoir été créé au niveau du SGBDR.
                        </li>
                        <li>Le troisième paramètre (<code>mabase_mdp</code>) est le mot de passe associé au login.</li>
                        <li>Le quatrième paramètre (<code>array(PDO::...)</code>) est relatif à la gestion des erreurs.
                        </li>
                    </ul>
                    <div class="bd-callout bd-callout-info">
                        <h4>Autres façons de définir le jeu de caractères</h4>
                        <p>Si vous effectuez une recherche, vous trouverez différentes façons de définir le jeu de
                            caractères, et les éditions précédentes de ce livre vous ont demandé d'utiliser ce code:</p>
                        <figure class="highlight">
                            <pre><code class="language-php" data-lang="php">$pdo-><span class="s">exec</span>('SET NAMES "utf8"'); </code></pre>
                        </figure>
                        <p> En effet, jusqu'à PHP 5.3.6, l'option charset n'était pas correctement appliquée par PHP.
                            Étant donné que cela est corrigé dans n'importe quelle version de PHP que vous allez
                            réellement utiliser, la définition du jeu de caractères dans la chaîne de connexion est
                            l'option préférée.
                        </p>
                    </div>
                    <div class="bd-callout bd-callout-warning">
                        <h4>Le login : root</h4>
                        <p>Il est déconseillé d'utiliser le login <code>root</code> ayant tous les droits pour se
                            connecter à une base de données depuis du code PHP. Il vaut mieux créer dans MySQL un
                            utilisateur dédié n'ayant des droits que sur cette base.</p>
                    </div>
                </article>
                <h3 id="connExcept">2 - <code>try/catch</code> La gestion des exceptions</h3>
                <article>
                    <p>Le serveur MySQL est un logiciel complètement distinct du serveur Web. Par conséquent, nous
                        devons considérer la possibilité que le serveur soit indisponible ou inaccessible en raison
                        d'une panne de réseau, ou parce que la combinaison nom d'utilisateur / mot de passe que vous
                        avez fournie est rejetée par le serveur, ou parce que vous avez simplement oublié de démarrer
                        votre serveur MySQL ! Dans de tels cas, <code>new PDO</code> ne fonctionnera pas et lèvera une
                        exception
                        PHP.
                        <br>Une exception PHP est ce qui se produit lorsque vous dites à PHP d'exécuter une tâche et
                        qu'il est incapable de le faire. PHP essaiera de faire ce qu'on lui dit, mais échouera; et afin
                        de vous informer de l'échec, il vous lancera une exception. Une exception est un peu plus que
                        PHP qui plante avec un message d'erreur spécifique. Lorsqu'une exception est levée, PHP
                        s'arrête. Aucune ligne de code après l'erreur ne sera exécutée.
                        <br> En tant que développeur responsable, c'est votre travail de détecter cette exception et de
                        faire
                        quelque chose pour que le programme puisse continuer.
                    </p>
                    <div class="bd-callout bd-callout-danger">
                        <h4>Exceptions non interceptées</h4>
                        <p>Si vous n'interceptez pas d'exception, PHP arrêtera d'exécuter votre script PHP et affichera
                            un
                            message d'erreur spectaculairement laid. Ce message d'erreur révélera même le code de votre
                            script qui a généré l'erreur. Dans ce cas, ce code contient votre nom d'utilisateur et votre
                            mot de passe MySQL, il est donc particulièrement important d'éviter que le message d'erreur
                            ne soit vu par les utilisateurs !</p>
                    </div>
                    <p>On peut traiter immédiatement les erreurs (base de données introuvable, mauvais login ou mot de
                        passe, etc) en intégrant la connexion dans un bloc <code>try/catch</code>. Il s'agit d'un
                        mécanisme de gestion des erreurs utilisant les <strong>exceptions</strong>. Sans rentrer dans
                        des détails inutiles, son fonctionnement est le suivant :</p>
                    <ol>
                        <li>Les instructions situées dans le bloc <code>try</code> sont exécutées.</li>
                        <li>Si l'une des instructions du bloc <code>try</code> provoque une erreur, elle est interceptée
                            par le bloc <code>catch</code>, dont les instructions sont alors exécutées.
                        </li>
                        <li>Si aucune instruction du bloc <code>try</code> n'échoue, le contenu du bloc
                            <code>catch</code> est ignoré et l'exécution se poursuit.
                        </li>
                    </ol>
                    <figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="s">try</span>{
$bdd = new <span class="s">PDO</span> ("<span class="cp">mysql</span>:<span class="na">host=</span><span class="s">localhost</span>;<span
                                class="na">dbname=</span><span class="s">mabase</span>;<span
                                class="na">charset=</span><span class="s">utf8</span>",<span
                                class="s">"mabase_util"</span>,
    <span class="s">"mabase_mdp"</span>, <span class="na">array</span>(<span class="cp">PDO::ATTR_ERRMODE</span>  =&gt; <span
                                class="cp">PDO::ERRMODE_EXCEPTION</span> ));
}
<span class="s">catch</span> (<span class="s">Exception</span> $e){
<span class="s">die</span>('Erreur fatale : ' . $e-&gt;<span class="s">getMessage()</span>);
}
<span class="c">// ...</span></code></pre>
                    </figure>
                    <p>Si un problème se produit pendant la connexion, l'exécution PHP est interrompue (fonction <code>die</code>)
                        et un message d'erreur est affiché. Sinon, le reste de la page est exécuté normalement.</p>
                    <p>Vous pouvez considérer une instruction try … catch</code> comme une instruction <code>if …
                        else</code>>, sauf que le
                        deuxième bloc de code correspond à ce qui se passe si le premier bloc de code ne s'exécute
                        pas. </p>
                    <p>La classe PDO dispose d'une <a target="_blank" href="http://www.php.net/manual/fr/class.pdo.php">documentation
                        en ligne</a>.</p>
                    <div class="bd-callout bd-callout-info">
                        <h4>La variable <code>$e</code></h4>
                        <p>La variable <code>$e</code> n'est pas en fait une chaîne, mais un <strong>objet</strong>.
                            Il est possible
                            de traiter la variable <code>$e</code> comme une chaîne et de l'utiliser pour imprimer un
                            message
                            d'erreur plus descriptif. </p>
                    </div>
                    <p>La classe PDOException a également une méthode <code>getMessage()</code> qui contient le message
                        d'erreur. Si vous souhaitez être plus explicite, vous pouvez modifier le bloc catch comme suit:
                    </p>
                    <figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="s">try</span>{
$bdd = new <span class="s">PDO</span> ("<span class="cp">mysql</span>:<span class="na">host=</span><span class="s">localhost</span>;<span
                                class="na">dbname=</span><span class="s">mabase</span>;<span
                                class="na">charset=</span><span class="s">utf8</span>",<span
                                class="s">"mabase_util"</span>,
    <span class="s">"mabase_mdp"</span>, <span class="na">array</span>(<span class="cp">PDO::ATTR_ERRMODE</span>  =&gt; <span
                                class="cp">PDO::ERRMODE_EXCEPTION</span> ));
}
<span class="s">catch</span> (<span class="s">PDOException</span> $e){
$sortie='Erreur fatale : ' . $e-&gt;<span class="s">getMessage()</span>;
}
<span class="c">// ...</span></code></pre>
                    </figure>
                    <p>Il existe d'autres méthodes, notamment <code>getFile()</code> et <code>getLine()</code>, pour
                        renvoyer le nom de fichier et
                        le numéro de ligne sur lesquels l'exception a été lancée. Vous pouvez générer un message
                        d'erreur très détaillé comme celui-ci: </p>
                    <figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="s">try</span>{
$bdd = new <span class="s">PDO</span> ("<span class="cp">mysql</span>:<span class="na">host=</span><span class="s">localhost</span>;<span
                                class="na">dbname=</span><span class="s">mabase</span>;<span
                                class="na">charset=</span><span class="s">utf8</span>",<span
                                class="s">"mabase_util"</span>,
    <span class="s">"mabase_mdp"</span>, <span class="na">array</span>(<span class="cp">PDO::ATTR_ERRMODE</span>  =&gt; <span
                                class="cp">PDO::ERRMODE_EXCEPTION</span> ));
}
<span class="s">catch</span> (<span class="s">PDOException</span> $e){
$sortie='Erreur fatale : ' . $e-&gt;<span class="s">getMessage()</span>.'dans '. $e-&gt;<span class="s">getFile()</span>.' : '.$e-&gt;<span
                                class="s">getLine()</span>;
}
<span class="c">// ...</span></code></pre>
                    </figure>
                    <p>Ceci est extrêmement utile si vous avez un grand site Web avec des dizaines de fichiers
                        d'inclusion. Le message d'erreur vous indiquera exactement dans quel fichier rechercher et sur
                        quelle ligne l'erreur s'est produite.</p>
                </article>
            </section>

        </main>
    </div>
</div>
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
        integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>
<!--<script src="../js/jquery-3.3.1.slim.min.js"></script>-->
<!--<script src="../js/popper.min.js"></script>-->
<!--<script src="../js/bootstrap.min.js"></script>-->
<script src="../js/docs.min.js"></script>
</body>
</html>