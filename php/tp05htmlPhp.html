<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="../dist/4.0/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
    <link href="../dist/4.0/css/docs.min.css" rel="stylesheet">
    <link href="../dist/4.0/css/docs.perso.td.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.17.1/themes/prism.css">
    <title>TP05 Php</title>

</head>
<body>
<header class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar">
    <a class="navbar-brand mr-0 mr-md-2" href="/" aria-label="Bootstrap">

    </a>

    <div class="navbar-nav-scroll">
        <ul class="navbar-nav bd-navbar-nav flex-row">
            <li class="nav-item">
                <a class="nav-link " href="tp01htmlPhp.html">TP PHP</a>
            </li>
        </ul>
    </div>
</header>
<div class="container-fluid">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 bd-sidebar">
            <nav class="collapse bd-links" id="bd-docs-nav">
                <div class="bd-toc-item active">
                    <a class="bd-toc-link " href="tp01htmlPhp.html">
                        TP01 - Affichage, déclaration de variables, tableaux
                    </a>
                </div>
                <div class="bd-toc-item active">
                    <a class="bd-toc-link" href="tp02htmlPhp.html">
                        TP02 - Tableaux, Boucles, formulaires
                    </a>
                </div>
                <div class="bd-toc-item active">
                    <a class="bd-toc-link" href="tp03htmlPhp.html">
                        TP03 - Tableaux Associatifs, Boucles foreach
                    </a>
                </div>
                <div class="bd-toc-item active">
                    <a class="bd-toc-link" href="tp04htmlPhp.html">
                        TP04 - Pattern MVC
                    </a>
                </div>

                <div class="bd-toc-item active">
                    <a class="bd-toc-link" href="tp05htmlPhp.html">
                        TP05 - Pattern MVC, connexion à un SGBD
                    </a>
                </div>
                <div class="bd-toc-item active">
                    <a class="bd-toc-link" href="tp06htmlPhp.html">
                        TP06 - Pattern MVC, Session
                    </a>
                </div>
            </nav>

        </div>
        <div class="d-none d-xl-block col-xl-2 bd-toc">
            <ul class="section-nav">
                <li class="toc-entry toc-h2"><a href="#prerequis">Prérequis</a></li>
                <li class="toc-entry toc-h2"><a href="#Exercice1">Exercice 1 - connexion à un SGBD</a></li>
                <li class="toc-entry toc-h2"><a href="#Exercice2">Exercice 2 - Modification du contrôleur</a></li>
                <li class="toc-entry toc-h2"><a href="#Exercice3">Exercice 3 - Création de la vue Produit</a></li>
                <li class="toc-entry toc-h2"><a href="#"></a></li>
            </ul>
        </div>
        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 bd-content" role="main">
            <h1>TP05 - Pattern MVC, connexion à un SGBD</h1>
            <hr class="my-4">
            <span class="fas fa-download" aria-hidden="true"></span>
            <a href="../download/phpTP05rapport.pdf" target="_blank">Format du rapport à télécharger</a>
            <br><span class="fas fa-question" aria-hidden="true"></span>
            <a href="https://tutowebdesign.com/bien-demarrer-bootstrap-4.php" target="_blank">Bootstrap</a>
            <br><span class="fas fa-download" aria-hidden="true"></span>
            <a href="../download/lafleur2013.zip" target="_blank">Dossier lafleur</a>
            <br><span class="fas fa-question" aria-hidden="true"></span>
            <a href="../download/AideMemoirePHP.pdf" target="_blank">Aide mémoire PHP</a>
            <br><span class="fas fa-question" aria-hidden="true"></span>
            <a href="http://boraklerouge.free.fr/PHP-AideMemoire/" target="_blank">Aide mémoire PHP</a>
            <br><span class="fas fa-question" aria-hidden="true"></span>
            <a href="https://openclassrooms.com/fr/courses/918836-concevez-votre-site-web-avec-php-et-mysql/914293-lisez-des-donnees"
               target="_blank">
                Connexion à un SGBD</a>
            <br><span class="fa fa-question" aria-hidden="true"></span>
            <a href="https://openclassrooms.com/fr/courses/1665806-programmez-en-oriente-objet-en-php/1666129-loperateur-de-resolution-de-portee"
               target="_blank">
                Classe statique</a>
            <br><span class="fa fa-question" aria-hidden="true"></span>
            <a href="https://www.php.net/manual/fr/book.pdo.php" target="_blank">Classe PDO</a>
                <div class="bd-callout bd-callout-info">
                    <h4>Avant de commencer</h4>
                    <p>Créez un répertoire TP05</p>
                </div>
                <div class="bd-callout bd-callout-info">
                    <h4>Téléchargez</h4>
                    <p>Téléchargez le dossier Lafleur</p>
                    <ul>
                        <li>créez la base</li>
                        <li>exécutez le script sql</li>
                        <li>copiez le répertoire image dans le répertoire TD05</li>
                    </ul>
                </div>

            <section id="prerequis">
            <h2>Prérequis</h2>
                <ol>
                <li>Copiez le code suivant dans un fichier que vous allez appeler TP05_index.php:
                <figure class="highlight"><pre><code class="language-php" data-lang="php">&lt;?php
    require_once 'TP05_m_PDO.php';
    include('TP04_m_model.php');
    include('TP04_v_entete.php');
    $lang = $menu01;
    include('TP05_v_menu.php');

    if(!isset($_REQUEST['uc']))
        $uc = 'accueil';
    else
        $uc = $_REQUEST['uc'];

    $pdo = PdoTd::getPdoTd();

    switch($uc)
    {
        case 'accueil':
            {
                include('TP04_v_accueil.php');break;}

        default :
            {
                include('TP05_c_controleur.php');break;}
    }
    include('TP02Pied.php') ;</code></pre></figure></li>
                <li>Copiez le code suivant dans un fichier que vous allez appeler TP05_v_menu.php:
                <figure class="highlight"><pre><code class="language-php" data-lang="php">&lt;nav class="navbar navbar-expand-lg navbar-light bg-light"&gt;
    &lt;ul class="navbar-nav"&gt;
        &lt;?php
        foreach ($lang as $cle =&gt; $valeur): ?&gt;
            &lt;li  class="nav-item"&gt;
                &lt;a class="nav-link" href="TP05_index.php?uc=controleur&action=&lt;?=$valeur;?&gt;"&gt;&lt;?php echo ucfirst($cle);?&gt;&lt;/a&gt;
            &lt;/li&gt;
        &lt;?php endforeach;//fin de la boucle ?&gt;
    &lt;/ul&gt;
&lt;/nav&gt;</code></pre></figure></li>
                <li>Copiez le code suivant dans un fichier que vous allez appeler TP05_m_PDO.php:
                    <div class="bd-callout bd-callout-info">
                        <h4>Modifications</h4>
                        <p>Modifiez le user et le mot de passe en fonction de votre connexion</p>
                    </div>
                <figure class="highlight"><pre><code class="language-php" data-lang="php">&lt;?php

class PdoTd
{

    private static $serveur = 'mysql:host=localhost';
    private static $bdd = 'dbname=baselafleur3';
    private static $user = 'root';
    private static $mdp = 'mysql';
    /**
     * @var PDO $monPdo
     */
    private static $monPdo;
    private static $monPdoTd = null;

    /**
     * Constructeur privé, crée l'instance de PDO qui sera sollicitée
     * pour toutes les méthodes de la classe
     *
     */
     private function __construct()
        {
            self::$monPdo = new PDO(self::$serveur.';'.self::$bdd, self::$user, self::$mdp);
            self::$monPdo->query("SET CHARACTER SET utf8");

        }
    public function _destruct(){
        self::$monPdo = null;
    }
    /**
     * Fonction statique qui crée l'unique instance de la classe
     *
     * Appel : $instancePdoTd = PdoTd::getPdoTd();
     * @return null l'unique objet de la classe PdoTd
     */
    public  static function getPdoTd()
    {
        if(self::$monPdoTd == null)
        {
            self::$monPdoTd= new PdoTd();
        }
        return self::$monPdoTd;
    }

    /**
     * @return array
     */
    public function getLesCategories()
    {
        $req = "select * from categorie";
        $res = self::$monPdo->query($req);
        $lesLignes = $res->fetchAll();
        return $lesLignes;
    }
    /**
     * @return array
     */
    public function getLesProduits()
    {
        $req="select * from produit";
        $res = self::$monPdo->query($req);
        $lesLignes = $res->fetchAll();
        return $lesLignes;
    }

}</code></pre></figure></li>
                <li>Copiez le code suivant dans un fichier que vous allez appeler TP05_c_controleur.php:
                <figure class="highlight"><pre><code class="language-php" data-lang="php">&lt;?php
$action = $_REQUEST['action'];
/**
 * @var PdoTd $pdo
 */
switch($action)
{
    case 'accueil':
        {
            include('TP04_v_accueil.php');
            break;
        }
    case 'produits' :
        {

            $lesCategories = $pdo->getLesCategories();

            $lesProduits = $pdo->getLesProduits();

            include('TP05_v_produits.php');
            break;
        }
    case 'contact' :
        {
            include('TP04_v_form.php');
            break;
        }
    case 'acces' :
        {
            include('TP04_v_construction.php');
            break;
        }
    case 'nous' :
        {
            include('TP04_v_construction.php');
            break;
        }
    case 'reponse' :
        {
            include('TP04_v_reponse.php');
            break;
        }
    default :
        {
            include('TP04_v_404.php');
            break;
        }
}</code></pre></figure></li>
                <li>Copiez le code suivant dans un fichier que vous allez appeler TP05_v_produits.php:
                <figure class="highlight"><pre><code class="language-php" data-lang="php">&lt;div class="container"&gt;
&lt;?php foreach($lesCategories as $uneCategorie) : ?&gt;
        &lt;h2&gt;&lt;?= $uneCategorie['libelle']; ?&gt;&lt;/h2&gt;
&lt;hr&gt;
&lt;div class="row"&gt;
&lt;?php foreach($lesProduits as $unProduit) :
        if ($uneCategorie['id']==$unProduit['idCategorie']):?&gt;
    &lt;div class="card col-3"&gt;
    &lt;img class="card-img-top" src="&lt;?= $unProduit['image']; ?&gt;" alt="Card image cap"&gt;
    &lt;div class="card-body"&gt;
        &lt;h5 class="card-title"&gt;&lt;?= $unProduit['description']; ?&gt;&lt;/h5&gt;
    &lt;/div&gt;
    &lt;div class="card-footer"&gt;
        &lt;p class="card-text"&gt;prix : &lt;?= $unProduit['prix']; ?&gt; €&lt;/p&gt;
    &lt;/div&gt;
&lt;/div&gt;
    &lt;?php endif; ?&gt;
    &lt;?php endforeach; ?&gt;
&lt;/div&gt;
        &lt;?php endforeach; ?&gt;
&lt;/div&gt;</code></pre></figure></li>
             <li><b>Quels sont les fichiers qui existent déjà et que vous devez rajouter ?</b></li>
                </ol>
                <div class="bd-callout bd-callout-info">
                    <h4>Tests</h4>
                    <p> Lancez TP05_index.php pour voir si tout fonctionne.</p>
                </div>
            </section>
            <section id="Exercice1">
            <h2>Exercice 1 - connexion à un SGBD</h2>

            <ol>
                <li>Pourquoi utiliser PDO pour se connecter à une base de données ?</li>
                <li>Que signifie :: ?</li>
                <li>Que signifie self ?</li>
                <li>Que signifie -> ?</li>
                <li>Que signifie query()?</li>
                <li>Que signifie fetchAll() ?</li>
            </ol>
            </section>
            <section id="Exercice2">
            <h2>Exercice 2 - Modification du contrôleur</h2>

            <ol>
                <li>Où est déclarée la variable $pdo ?</li>
                <li>Lorsque vous cliquez sur Nos produits que se passe-t-il au niveau du contrôleur ?</li>
                <li>Quel est le type des variables $lesCategories et $lesProduits ? Pourquoi ?</li>
            </ol>
            </section>
            <section id="Exercice3">
            <h2>Exercice 3 - Création de la vue Produit</h2>

            <ol>
                <li>A quoi correspond foreach ?</li>
                <li>Après les balises class container mettre &lt;? var_dump($catégories); ?&gt; que constatez vous ?</li>
                <li>Que teste-t-on dans la condition du if ?</li>
            </ol>
            </section>
            <div class="text-right">
            <a href="#" id ="backToTopBtn" class="well well-sm"><i class="fa fa-chevron-up"></i> </a>
        </div>
    </main>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.17.1/prism.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.17.1/plugins/autoloader/prism-autoloader.js" data-autoloader-path="https://cdn.jsdelivr.net/npm/prismjs@1.17.1/components/"></script>

</body>
</html>
