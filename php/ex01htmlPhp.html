<!DOCTYPE html>
<html lang="fr">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="../dist/5.0/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="../dist/5.0/css/docs.css" rel="stylesheet">
    <link href="../dist/5.0/bootstrap-icons/bootstrap-icons-1.2.2/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism.css">
    <link rel="icon" type="image/png"  href="../img/favicon.png">
    <title>PHP Ex01</title>

</head>
<body>

<!--        navbar-->
<header class="navbar navbar-expand-md navbar-dark bd-navbar bg-success">
    <nav class="container-xxl flex-wrap flex-md-nowrap" aria-label="Main navigation">
        <div class="collapse navbar-collapse" id="bdNavbar">
            <ul class="navbar-nav flex-row flex-wrap bd-navbar-nav pt-2 py-md-0">
                <li class="nav-item">
                    <a class="nav-link " href="tp01htmlPhpNew.html">TP PHP</a>

                <li class="nav-item">
                    <a class="nav-link " href="index.html">Documentation</a>

            </ul>
        </div>
    </nav>
</header>
<nav class="bd-subnavbar py-2" aria-label="Secondary navigation"></nav>
<div class="container-xxl my-md-4 bd-layout">
    <!--    Menu Gauche-->
    <aside class="bd-sidebar">
        <nav class="collapse bd-links" id="bd-docs-nav" aria-label="Docs navigation">
            <ul class="list-unstyled mb-0 py-3 pt-md-1">
                <li class="mb-1">
                    <button class="btn d-inline-flex align-items-center rounded collapsed text-start justify-content-start"
                            data-bs-toggle="collapse" data-bs-target="#php01Gintroduction" aria-expanded="false">
                        I - Introduction au développement Web
                    </button>
                    <div class="collapse" id="php01Gintroduction">
                        <ul class="list-unstyled fw-normal pb-1 small">
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="php01Gintroduction.html#foncweb">
                                    Principes de fonctionnement du Web
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li class="mb-1">
                    <button class="btn d-inline-flex align-items-center rounded collapsed text-start"
                            data-bs-toggle="collapse" data-bs-target="#php02Gbaseslg" aria-expanded="false">
                        II - Les bases du langage
                    </button>
                    <div class="collapse" id="php02Gbaseslg">

                        <ul class="list-unstyled fw-normal pb-1 small">
                            <li><a class="d-inline-flex align-items-center rounded active"
                                   href="php02Gbaseslg.html">Les bases du langage
                            </a></li>
                        </ul>
                    </div>
                </li>
                <li class="mb-1">
                    <button class="btn d-inline-flex align-items-center rounded collapsed text-start"
                            data-bs-toggle="collapse" data-bs-target="#php031ProgPhp_Variables" aria-expanded="false">
                        III - Programmer avec PHP
                    </button>
                    <div class="collapse" id="php031ProgPhp_Variables">

                        <ul class="list-unstyled fw-normal pb-1 small">
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="php031ProgPhp_Variables.html">A - Les variables
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="php032ProgPhp_Tests.html">B - Tests et conditions
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="php033ProgPhp_Tableaux.html">C - Les tableaux
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="php034ProgPhp_Boucles.html">D - Les boucles
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="php035ProgPhp_Fonctions.html"> E - Les fonctions
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="php036ProgPhp_Raccourcis.html"> F - Les raccourcis
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li class="mb-1">
                    <button class="btn d-inline-flex align-items-center rounded collapsed text-start"
                            data-bs-toggle="collapse" data-bs-target="#php041Transmission" aria-expanded="false">
                        IV - Transmettre des données entre des pages
                    </button>
                    <div class="collapse" id="php041Transmission">

                        <ul class="list-unstyled fw-normal pb-1 small">
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="php041Transmission.html">A - Notion de variable superglobale
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="php042Transmission.html">B - Notion de formulaire
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="php043Transmission.html">C - $_GET et la transmission via l'URL
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="php044Transmission.html">D - $_POST et la transmission via un formulaire
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="php045Transmission.html">E - $_SESSION et la transmission via la session
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="php046Transmission.html">F - La transmission de données et sécurité
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li class="mb-1">
                    <button class="btn d-inline-flex align-items-center rounded collapsed text-start"
                            data-bs-toggle="collapse" data-bs-target="#php05AccesSGBD_Introduction"
                            aria-expanded="false">
                        V - Accéder à une base de données
                    </button>
                    <div class="collapse" id="php05AccesSGBD_Introduction">

                        <ul class="list-unstyled fw-normal pb-1 small">
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="php05AccesSGBD_Introduction.html"> A - Introduction
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="php05AccesSGBD_Connexion.html">B - Connexion à la base de données
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="php05AccesSGBD_RappelSQL.html">C - Rappel SQL avec SELECT
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="php05AccesSGBD_RqtSimple.html">D - query - Requêtes simples
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="php05AccesSGBD_RqtParam.html">E - prepare et execute - Requêtes avec paramètres
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="php05AccesSGBD_RqtLMD.html">F - Le cas particulier avec INSERT, UPDATE,
                                    DELETE et exec</a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li class="mb-1">
                    <button class="btn d-inline-flex align-items-center rounded collapsed text-start justify-content-start"
                            data-bs-toggle="collapse" data-bs-target="#phpTP" aria-expanded="false">
                        TP - les bases du PHP
                    </button>
                    <div class="collapse" id="phpTP">
                        <ul class="list-unstyled fw-normal pb-1 small">
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="tp01htmlPhpNew.html">
                                    TP01 - Affichage, déclaration de variables, tableaux
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="tp02htmlPhpNew.html">
                                    TP02 - Tableaux, Boucles, formulaires
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="tp03htmlPhpNew.html">
                                    TP03 - Tableaux Associatifs, Boucles foreach
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="tp04htmlPhpNew.html">
                                    TP04 - Pattern MVC

                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="tp05htmlPhpNew.html">
                                    TP05 - Pattern MVC, Session

                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="tp06htmlPhpNew.html">
                                    TP06 - Pattern MVC, connexion à un SGBD
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li class="mb-1 active">
                    <button class="btn d-inline-flex align-items-center rounded collapsed text-start justify-content-start"
                            data-bs-toggle="collapse" data-bs-target="#phpEx" aria-expanded="true" aria-current="true">
                        Exercices sur le MVC
                    </button>
                    <div class="collapse show" id="phpEx">
                        <ul class="list-unstyled fw-normal pb-1 small">
                            <li>
                                <a class="d-inline-flex align-items-center rounded active" href="ex01htmlPhp.html">
                                    Ex01 - Modifier un site en fonction du pattern MVC
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="ex02htmlPhp.html">
                                    Ex02 - Création d'un contrôleur
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>
            </ul>
        </nav>
    </aside>

    <main class="bd-main order-1">
        <!--            Titre-->
        <div class="bd-intro ps-lg-4">
            <div class="d-md-flex flex-md-row align-items-center justify-content-between">
                <h1 class="bd-title" id="content">Ex01 - Modifier un site en fonction du pattern MVC</h1>
            </div>

            <div class="bd-callout bd-callout-info">
                <h4 class="text-info">Objectif</h4>
                <p>Exercice à faire à partir du TP sur le PHP</p>
            </div>
            <hr class="my-4">
        </div>
        <!--            Menu droite-->
        <div class="bd-toc mt-4 mb-5 my-md-0 ps-xl-3 mb-lg-5 text-muted">
            <strong class="d-block h6 my-2 pb-2 border-bottom">Dans cette page</strong>
            <nav id="TableOfContents">
                <ul>
                    <li><a href="#tp01prerequis">Prérequis</a></li>
                    <li><a href="#tp01Ex1">Partie 1 - Exécution du site initial</a></li>
                    <ul>
                        <li><a href="#tp01ex1a">a - Exécution du script</a></li>
                        <li><a href="#tp01ex1b">b - Exécution de l'application</a></li>
                    </ul>
                    <li><a href="#tp01Ex2">Partie 2 - Modification de l'application sous forme MVC</a></li>
                    <ul>
                        <li><a href="#tp01ex2a">a - structure attendue</a></li>
                        <li><a href="#tp01ex2b">b - l'accès aux données</a></li>
                        <li><a href="#tp01ex2c">c - gestion des données du formulaire</a></li>
                        <li><a href="#tp01ex2d">d - modification de la page erreur</a></li>
                    </ul>
                </ul>
            </nav>
        </div>
        <!--            Docs-->
        <div class="bd-content ps-lg-4">
            <section>

                <div class="bd-callout bd-callout-danger">
                    <h4 class="text-danger">Attention</h4>
                    <p>Ne remplissez pas le rapport sur votre navigateur , vous ne pourrez pas le sauvegarder.</p>
                    <p>Téléchargez le sur votre disque dur !</p>
                </div>
                <div class="list-group-flush">
                    <a class="list-group-item list-group-item-action " href="../download/AideMemoirePHP.pdf"
                       target="_blank"><i class="bi bi-patch-question"></i> Aide mémoire PHP</a>
                    <a class="list-group-item list-group-item-action "
                       href="http://boraklerouge.free.fr/PHP-AideMemoire/" target="_blank"><i
                            class="bi bi-patch-question"></i> Aide mémoire PHP</a>
                </div>
            </section>
            <h2 id="tp01prerequis">Prérequis</h2>
            <section>
                <h4 class="text-info">Avant de commencer</h4>
                <ul class="list-group-flush">
                    <li class="list-group-item list-group-item-action "><i class="bi bi-folder"></i> Créez un répertoire
                        EX01
                    </li>
                    <li class="list-group-item list-group-item-action "><i class="bi bi-folder-plus"></i> Créez dans ce
                        répertoire,
                        le dossier <code>anuaireMVC</code>
                    </li>
                    <li class="list-group-item list-group-item-action "><i class="bi bi-download"></i> Téléchargez le
                        fichier annuaire01
                    </li>
                    <li class="list-group-item list-group-item-action "><i class="bi bi-file-zip"></i> Décompressez le
                        fichier
                        dans le répertoire Ex01.
                    </li>
                </ul>
                <div class="bd-callout bd-callout-danger">
                    <h4 class="text-danger">Attention</h4>
                    <p>Vérifiez bien que vous êtes en UTF8.</p>
                </div>
            </section>
            <h2 id="tp01Ex1">Partie 1 - Exécution du site initial</h2>
            <section>
                <h3 id="tp01ex1a">a - Exécution du script</h3>
                <article>
                    <p>Pour rappel, vous devez exécuter le fichier <code>export_base.sql</code> avec
                        <a href="tp06htmlPhpNew.html#script">phpMyAdmin</a></p>
                    <div class="bd-callout bd-callout-info">
                        <h4>Remarque</h4>
                        <p>Dans ce script, la création de la base est automatique. En cas de problèmes, vous pouvez la
                            créer à la main avec le nom <code>annuaire</code>.</p>
                    </div>
                </article>
                <h3 id="tp01ex1b">b - Exécution de l'application</h3>
                <article>
                    <p>En lançant le fichier <code>index.php</code>, l'application fournie 3 vues, avec les résultats suivants :</p>

                    <div class="bd-callout bd-callout-info bg-secondary text-white">
                        <h4>Résultat de la première vue</h4>
                        <p>Vous avez la vue accueil :</p>
                        <img src="images/Ex/bridgeAccueil.PNG" class="img-fluid" alt="menuAccueil">
                    </div>
                    <div class="bd-callout bd-callout-info bg-secondary text-white">
                        <h4>Résultat de la deuxième vue</h4>
                        <p>Vous avez la vue saisie formulaire :</p>
                        <img src="images/Ex/bridgeInsertUser.PNG" class="img-fluid" alt="menuAccueil">
                    </div>
                    <div class="bd-callout bd-callout-info bg-secondary text-white">
                        <h4>Résultat de la troisième vue</h4>
                        <p>Vous avez la vue erreur, lorsque par exemple vous cliquez sur le bouton du formulaire sans remplir les champs :</p>
                        <img src="images/Ex/brideErreur.PNG" class="img-fluid" alt="menuAccueil">
                    </div>
                </article>
            </section>
            <h2 id="tp01Ex2">Partie 2 - Modification de l'application sous forme MVC</h2>
            <section>
                <h3 id="tp01ex2a">a - structure attendue</h3>
                <article>
                    <p>Sous sa  forme MVC, vous devez avoir, la structure suivante :</p>
                    <ol>
                        <li>1 fichier index,</li>
                        <li>1 fichier contrôleur,</li>
                        <li>1 fichier modèle,</li>
                        <li>3 fichiers vue,</li>
                        <li>1 fichier css.</li>
                    </ol>
                    <p>en conservant les mêmes noms, la structure ressemblera au schéma suivant :</p>
                    <pre><code class="language-sh" translate="no">├── index.php
├── ctrl_annuaire.php
├── m_model.php
├── vue_accueil.php
├── vue_erreur.php
├── vue_formulaire_annuaire.php
└── style_op.css
</code></pre>

                    <div class="bd-callout bd-callout-warning bg-warning">
                        <h4><i class="bi bi-cone-striped"></i> Travail à faire :</h4>
                        <ol>
                            <li>Copiez-collez le fichier style_op.css</li>
                            <li>Copiez-collez dans le fichier m_model, le code à partir du <a href="tp06htmlPhpNew.html#ex2">TP</a></li>
                            <li>Copiez-collez dans le fichier index, le code à partir du <a href="tp04htmlPhpNew.html#titrea">TP</a></li>
                            <li>Copiez-collez dans le fichier vue_accueil, le code à partir du fichier index de l'application originale</li>
                            <li>Copiez-collez dans le fichier vue_erreur</li>
                            <li>Copiez-collez dans le fichier vue_formulaire_annuaire, le code à partir du fichier formulaire_annuaire
                                de l'application originale</li>
                            <li>Dans le fichier vue_formulaire_annuaire, retirez le code PHP</li>
                            <li>Copiez-collez dans le fichier ctrl_annuaire, le code à partir du <a href="tp04htmlPhpNew.html#titrec">TP</a></li>
                            <li>Dans le contrôleur, les actions attendues sont :</li>
                            <ul>
                                <li>accueil : pour afficher la vue accueil
                                <li>insertionUser : pour afficher la vue du formulaire</li>
                                <li>validationUser : pour afficher la vue accueil</li>
                                <li>par défaut : affichage de la vue erreur</li>
                            </ul>
                        </ol>
                        <h4>Faites les modification nécessaires</h4>
                        <p>Lancez votre application et afficher les 2 vues: vue_accueil, vue_formulaire_annuaire</p>
                    </div>
                </article>
                <h3 id="tp01ex2b">b - l'accès aux données</h3>
                <article>
                   <h4>Modification du fichier m_model</h4>
                    <p>Dans l'application originale, le fichier <code>fonction.php</code> contient la fonction
                        d'insertion dans la base de données, en mysqli. Voici un exemple de fonction d'insertion en pdo :</p>
                    <pre><code class="language-php" data-lang="php">public function insert($nom, $prenom)
    {
        try {
            $req ='INSERT INTO membres (id,nom,prenom) VALUES($this->getMaxId(),$nom,$prenom)';

            PdoBridge::$monPdo->($req);

            return true;
        } catch (PDOException $e) {
           echo 'Exception reçue : ',  $e->getMessage(), "\n";
            return false;
        }

    }</code></pre>

                    <div class="bd-callout bd-callout-warning bg-warning">
                        <h4><i class="bi bi-cone-striped"></i> Modification du fichier m_model</h4>
                        <ol>
                            <li>Modifiez les paramètres de connexion pour qu'ils correspondent à votre application.</li>
                            <li>Créez dans le fichier m_model, la signature de la fonction insert_membre.</li>
                            <li>Pour construire la fonction aidez vous de son code dans le fichier fonction.php et
                            du code ci-dessus.</li>
                            <li>Créez l'instanciation de la classe Pdo dans le fichier index comme dans le <a
                                    href="tp06htmlPhpNew.html#ex2">TP</a></li>
                        </ol>
                        <h4>Si vous exécutez index.php vous ne devez pas avoir d'erreurs</h4>
                    </div>
                </article>
                <h3 id="tp01ex2c">c - gestion des données du formulaire</h3>
                <article>
                    <p>Il s'agit maintenant de modifier le contrôleur, afin : </p>
                    <ul>
                        <li>de récupérer les données du nom et du prénom envoyées par le formulaire,</li>
                        <li>d'appeler la méthode insert_membre, avec les données du formulaire en paramètres.</li>
                    </ul>
                    <div class="bd-callout bd-callout-warning bg-warning">
                        <h4><i class="bi bi-cone-striped"></i> Modification du contrôleur</h4>
                        <ol>
                            <li>dans la partie, case de validationUser, copiez coller la partie du code qui se trouve
                            dans le fichier ctrl_annuaire.php original. </li>
                            <li>supprimez les fonctions header et remplacez les par un include de la vue correspondante.</li>
                            <li>remplacez $message_erreur par $erreur</li>
                            <li>supprimez la fonction require car elle appelle un fichier qui n'existe pas.</li>
                            <li>en suivant cet <a href="tp06htmlPhpNew.html#ex3">exemple</a>, modifiez l'appel de la fonction
                                insert_membre, pour qu'il corresponde à un appel pdo</li>
                            <li>rajoutez un message dans le cas default</li>
                        </ol>
                    </div>
                </article>
                <h3 id="tp01ex2d">d - modification de la page erreur</h3>
                <article>
                    <p>Si vous avez bien regardé le code de la page erreur, vous avez vue que le texte de l'erreur est récupéré sous forme de GET.
                    </p>
                    <div class="bd-callout bd-callout-warning bg-warning">
                        <h4><i class="bi bi-cone-striped"></i> Modification de la vue erreur</h4>
                        <ol>
                            <li>Comme vous l'avez fait dans le <a href="tp04htmlPhpNew.html#titreb">TP</a>, modifiez le code PHP
                            pour que la vue affiche le message d'erreur envoyé par le contrôleur.</li>
                        </ol>
                    </div>
                </article>
            </section>
        </div>
        <span class="text-end">
                    <a href="#bdNavbar" id="backToTopBtn" style="font-size: 2rem; color: cornflowerblue;"><i
                            class="bi bi-chevron-up"></i> </a>
            </span>
    </main>
</div>
<script src="../dist/5.0/js/bootstrap.bundle.min.js"></script>
<script src="../dist/5.0/js/docs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/prism.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.js"
        data-autoloader-path="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/components/"></script>

</body>
</html>