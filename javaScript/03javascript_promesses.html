<!doctype html>
<html lang="fr">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="../dist/5.0/css/bootstrap.min.css" rel="stylesheet" media="screen">
<link href="../dist/5.0/css/docs.css" rel="stylesheet">
    <link href="../dist/5.0/bootstrap-icons/bootstrap-icons-1.2.2/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism.css">
    <link rel="icon" type="image/png"  href="../img/favicon.png">
    <title>Js Promise</title>

</head>
<body>

<!--        navbar-->
<header class="navbar navbar-expand-md navbar-dark bd-navbar bg-success">
    <nav class="container-xxl flex-wrap flex-md-nowrap" aria-label="Main navigation">
        <div class="collapse navbar-collapse" id="bdNavbar">
            <ul class="navbar-nav flex-row flex-wrap bd-navbar-nav pt-2 py-md-0">
                <li class="nav-item">
                    <a class="nav-link " href="">Guide Stack npm express esj mysql </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="">Documentation</a>
                </li>
            </ul>
        </div>
    </nav>
</header>
<nav class="bd-subnavbar py-2" aria-label="Secondary navigation"></nav>
<div class="container-xxl my-md-4 bd-layout">
    <!--        Menu Gauche-->
    <aside class="bd-sidebar">
        <nav class="collapse bd-links" id="bd-docs-nav" aria-label="Docs navigation">
            <ul class="list-unstyled mb-0 py-3 pt-md-1">
                <li class="mb-1 active">
                    <button class="btn d-inline-flex align-items-center rounded collapsed text-start justify-content-start"
                            data-bs-toggle="collapse" data-bs-target="#javascript_programmer" aria-expanded="true" aria-current="true">
                        1 - Programmer avec Javascript
                    </button>
                    <div class="collapse show" id="javascript_programmer">
                        <ul class="list-unstyled fw-normal pb-1 small">
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="00javascript_intro.html">A - Introduction
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="05javascript_affichage.html">B - Affichage
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="06javascript_variables.html">C - Les variables
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="07javascript_tableau.html">D - Les tableaux
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="08javascript_objet.html">E - Les objets n'ont pas de classes
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="09javascript_testboucles.html">F - Les tests et les boucles
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="02javascript_fonctions.html">G - Les fonctions
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="04javascript_classes.html">H - Les Classes en ES6
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded active"
                                   href="03javascript_promesses.html">I - Les Promesses
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li class="mb-1">
                    <button class="btn d-inline-flex align-items-center rounded collapsed text-start justify-content-start"
                            data-bs-toggle="collapse" data-bs-target="#express" aria-expanded="false">
                        2 - NodeJs et ExpressJs
                    </button>
                    <div class="collapse" id="express">
                        <ul class="list-unstyled fw-normal pb-1 small">
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="100express_intro.html">
                                    A - Introduction
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="115express_installation.html">
                                    B - Installation
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="120express_affichage.html">
                                    C - Démarrer et Afficher
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="125express_mvc.html">
                                    D - Architecture MVC
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="130javascript_sgbd.html">
                                    E - Connexion à un SGBD
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="140javascript_mvc3.html">
                                    F - Création de page avec URL Paramétrée
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="150sessions.html">
                                    G - Gérer les sessions
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li class="mb-1">
                    <button class="btn d-inline-flex align-items-center rounded collapsed text-start justify-content-start"
                            data-bs-toggle="collapse" data-bs-target="#dom" aria-expanded="false">
                        3 - Manipuler le DOM
                    </button>
                    <div class="collapse" id="dom">
                        <ul class="list-unstyled fw-normal pb-1 small">
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="200dom_intro.html">
                                    A - Introduction
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="210dom_crud.html">
                                    B - Manipulation de l'objet Document
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="220dom_crudElement.html">
                                    C - Création manipulation d'éléments
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="230dom_event.html">
                                    D -  Associer un évènement à un nœud
                                </a>
                            </li>
                            <li>
                                <a class="d-inline-flex align-items-center rounded collapsed"
                                   href="240dom_exemple.html">
                                    E -  Exemple récapitulatif
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>
            </ul>
        </nav>
    </aside>
    <!--        Page de cours-->
    <main class="bd-main order-1">
        <!--            Titre-->
        <div class="bd-intro ps-lg-4">
            <div class="d-md-flex flex-md-row ">
                <h1 class="bd-title" id="content">I - Les Promesses</h1>
            </div>
        </div>
        <!--        Menu droite-->
        <div class="bd-toc mt-4 mb-5 my-md-0 ps-xl-3 mb-lg-5 text-muted">
            <strong class="d-block h6 my-2 pb-2 border-bottom">Dans cette page</strong>
            <nav id="TableOfContents">
                <ul>
                    <li><a href="#thread">1 - Les Threads</a></li>
                    <li><a href="#callback">2 - Les Callback</a></li>
                    <li><a href="#promises">3 - Les Promesses</a></li>
                    <li><a href="#asyncawait">4 - Async/Await</a></li>
                </ul>
            </nav>
        </div>

        <!--            Docs-->
        <div class="bd-content ps-lg-4">
            <h2 id="thread">1 - Les Threads</h2>
            <section>
                <h3>Traitement mono-thread</h3>
                <p> JavaScript s'exécute sur un seul thread de traitement. Lors de l'exécution dans un onglet de
                    navigateur,
                    tout le reste s'arrête. Ceci est nécessaire car les modifications apportées au DOM de la page ne
                    peuvent
                    pas se produire sur des threads parallèles; il serait dangereux qu'un thread redirige vers une URL
                    différente tandis qu'un autre tente d'ajouter des nœuds enfants.

                    <br>Cela est rarement évident pour l'utilisateur, car le traitement se produit rapidement par petits
                    morceaux. Par exemple, JavaScript détecte un clic sur un bouton, exécute un calcul et met à jour le
                    DOM.
                    Une fois terminé, le navigateur est libre de traiter l'élément suivant de la file d'attente.</p>
                <div class="bd-callout bd-callout-info">
                    <h4>Note latérale:</h4>
                 <p>D'autres langages tels que PHP utilisent également un seul thread mais peuvent
                     être
                     gérés par un serveur multi-thread tel qu'Apache. Deux requêtes sur la même page PHP en même temps
                     peuvent initier deux threads exécutant des instances isolées de PHP Durée.</p>
                </div>

                <h3>Devenir asynchrone avec les rappels</h3>
                <p>Les threads simples posent un problème. Que se passe-t-il lorsque JavaScript appelle un processus
                    «lent»
                    tel qu'une requête Ajax dans le navigateur ou une opération de base de données sur le serveur? Cette
                    opération peut prendre plusieurs secondes, voire quelques minutes . Un navigateur se verrouillait en
                    attendant une réponse. Sur le serveur, une application Node.js ne serait pas en mesure de traiter
                    d'autres demandes d'utilisateurs. Voici un exemple :</p>
                <pre><code class="language-js" data-lang="js" translate="no">// tableau d'objets post
const posts=[
    {title:'post one',body:'est post1'},
    {title:'post two',body:'est post2'},
]
// fonction d'affichage des posts
function getPosts(){
    setTimeout(()=>{
        let output='';
        posts.forEach((post,index)=&gt{
            output +=`&ltli&gt${post.title}&lt/li&gt`
        })
        document.body.innerHTML=output;
    },1000);
}
// function pour rajouter un post
function createPost(post){
    setTimeout(()=>{
        posts.push(post);
    },2000);
}                </code></pre>
                <p>Appelez les méthodes :</p>
                <pre><code class="language-js" data-lang="js" translate="no">// Affichage des posts
getPosts();
//Création du post
createPost({title:'post three',body:'est post3'});</code></pre>
                <p>En exécutant c code, vous constaterez que le post n'est jamais créé. En effet, l'exécution du code
                    d'affichage,
                    lancée par la fonction <code>setTimeout</code>, 1000, se fait avant l'exécution du code de création
                    du post, 2000.
                </p>
                <div class="bd-callout bd-callout-warning bg-warning">
                    <h4><i class="bi bi-cone-striped"></i>Application mono thread</h4>
                    <ol>
                        <li>exécutez ce code</li>
                        <li>inversez les chiffres, vous verez que l'exécution correspondra à ce que l'on attend.</li>
                    </ol>
                </div>
            </section>
            <h2 id="callback">2 - Les Callback</h2>
            <section>
                <p>La solution est le traitement asynchrone. Plutôt que d'attendre la fin, un processus est invité à
                    appeler une autre fonction lorsque le résultat est prêt. C'est ce qu'on appelle un rappel et il est
                    passé en tant qu'argument à toute fonction asynchrone.
                    <br> Reprenons notre exemple avec un callback :</p>
                <pre><code class="language-js" data-lang="js" translate="no">// Modification de la fonction de création
function createPost(post,callback){
    setTimeout(()=>{
        posts.push(post);
        callback()
    },2000);
} </code></pre>
                <p>L'appel de la fonction sera un peut différent car il faut que la fonction de création soit finie pour
                    effectuer l'affichage.
                    La fonction <code>getPosts</code> est passée en callback</p>
                <pre><code class="language-js" data-lang="js" translate="no">createPost({title:'post three',body:'est post3'},getPosts());</code></pre>
                <p>Mais cette méthode a un inconveignant, elle devient illisible lorsque les callbacks s'enchainent.</p>
            </section>
            <h2 id="promises">2 - Les Promesses</h2>
            <section>
                <p>ES2015 (ES6) a introduit les promesses . Les rappels sont toujours utilisés sous la surface, mais les
                    promesses fournissent une syntaxe plus claire qui enchaîne les commandes asynchrones afin qu'elles
                    s'exécutent en série (plus à ce sujet dans la section suivante ).

                    <br>Pour activer l'exécution basée sur Promise, les fonctions basées sur le rappel asynchrone
                    doivent
                    être modifiées afin qu'elles renvoient immédiatement un objet Promise. Cet objet promet d'exécuter
                    l'une des deux fonctions (passées en arguments) à un moment donné dans le futur:</p>
                <ul>
                    <li>resolve: une fonction de rappel exécutée lorsque le traitement se termine avec succès, et</li>
                    <li>reject: une fonction de rappel optionnelle s'exécute en cas d'échec.</li>
                </ul>
                <p>Voici la modification de notre exemple :</p>
                <pre><code class="language-js" data-lang="js" translate="no">function createPost(post) {
    return new Promise((resolve, reject) => {
            setTimeout(() => {
                posts.push(post);
                const error = false;
                if (!error) {
                    resolve();
                } else {
                    reject('Erreur')
                }
            }, 2000)
        }
    );
}</code></pre>
                <p>La fonction renvoie une promesse qui exécutera la fonction <code>setTimeout</code> s'il n'y a pas
                    d'erreurs.
                    Dans le cas contraire, elle renverra une erreur.
                    <br>L'appel de cette fonction doit tenir compte des deux cas.</p>
                <pre><code class="language-js" data-lang="js" translate="no">createPost({title: 'post three', body: 'est post3'})
    .then(getPosts) // Exécution de getposts s'il n'y a pas d'erreurs
    .catch(err => console.log(err)); // Exécution du cas où la promesse renvoie une erreur</code></pre>
                <p>Les promesses réduisent l'enfer des rappels mais introduisent leurs propres problèmes.

                    <br>Les didacticiels omettent souvent de mentionner que toute la chaîne Promise est asynchrone .
                    Toute
                    fonction en utilisant une série de promesses doit soit retourner ses propres fonctions de rappel
                    Promise ou d'exécution dans les méthodes finales <code>.then()</code>, <code>.catch()</code>ou des
                    <code>.finally()</code>.</p>
            </section>
            <h2 id="asyncawait">4 - Async/Await</h2>
            <section>
                <p>Les promesses peuvent être décourageantes, c'est pourquoi ES2017 a introduit <code>async</code> et <code>await</code>. Bien que
                    ce ne soit que du sucre syntaxique, cela rend les promesses beaucoup plus douces et vous pouvez
                    éviter les chaînes <code>.then()</code>.
                    <br>Voici votre code modifié, au niveau de l'appel cette fois :</p>
                <pre><code class="language-js" data-lang="js" translate="no">// création d'une fonction anonyme de sortie
const output=async ()=>{
    try{
        //Création du post
        const rep= await createPost({title:'post three',body:'est post3'});
        console.log(rep);//affiche OK
        // Affichage des posts
        getPosts();

    }catch(err){
        console.log(err);
    }

}
// Appel de la fonction
output()</code></pre>
                <p>L'appel du code est ici plus conforme à l'enchainement logique des méthodes.</p>
            </section>
        </div>
    </main>
</div>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/prism.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.js"
        data-autoloader-path="https://cdn.jsdelivr.net/npm/prismjs@1.17.1/components/"></script>
<script src="../dist/5.0/js/bootstrap.bundle.min.js"></script>
<script src="../dist/5.0/js/docs.min.js"></script>
</body>
</html>